# 4.5 CPU 코어 수와 스레드 수 사이의 관계는 무엇일까?

## 4.5.1 레시피와 코드, 볶음 요리와 스레드

요리사는 레시피에 따라 특정 작업을 실해앟여 특정한 요리를 만들고, CPU는 기계 명령어에 따라 프로세스와 스레드를 실행한다.<br>
운영 체제 입장에서 CPU가 사용자 상태에서 실행하는 명령어는 모두 스레드 또는 특정 스레드에 속해 있다. 따라서 명령어에 따라 프로세스를 실행한다.<br>
요리사 수는 CPU 코어 수에 비유할 수 있으며, 일정 시간 동안 볶을 수 잇는 요리 수는 스레드 수에 비유할 수 있다.<br>
CPU 코어 수와 스레드 수 사이에는 어떤 필연 관계도 없다. CPU는 하드웨어인데 반해 스레드는 소프트웨어 개념, 더 정확하게는 실행 흐름이자 작업이다.<br>
따라서 단일 코어 시스템에서도 메모리가 충분하고, 운영 체제에 제한이 없다면 얼마든지 많은 스레드를 생성할 수 있다.<br><br>

CPU는 근본적으로 자신이 실행하는 명령어가 어떤 스레드에 속하는지 이해하지 못하며, 이를 이해해야 하는 것은 운영 체제이다.<br>
CPU가 해야 하는 일은 PC 레지스터 주소에 따라 메모리에서 기계 명령어를 꺼내 실해아는 것뿐이다.<br>

## 4.5.2 작업 분할과 블로킹 입출력

단일 코어 시스템에서는 CPU는 일정 시간 동안 단 하나의 스레드만 실행할 수 있어 스레드 여러 개가 번갈아 실행되기는 하지만, 진정한 병렬 처리라고는 할 수 없다.<br>
그렇다고 단일 코어에서 단일 코어에서 다중 스레드가 의미가 없는 것은 아니다.<br>
스레드라는 개념은 프로그래머에게 매우 편리한 추상화 방법을 제공하므로 작업 하나를 여러 개로 분할한 후 각각의 하위 작업을 별도의 스레드에 배치하면 운영 체제에서 이를 스케줄링하고 실행할 수 있으므로 동시에 여러 작업을 실행할 수 있다.<br>
예를 들어 사용자 인터페이스 요소 뒤에서 대량의 계산을 수행해야 한다고 할 때, 계산 작업을 별도의 스레드에 넣어 계산을 수행하는 동안 사용자 인터페이스가 멈추는 것을 방지할 수 있다.<br>
이외에도 처리해야 하는 작업이 블로킹 입출력과 관련되었을 때 해당 블로킹 호출을 별도의 스레드에서 실행하면 나머지 코드는 영향 없이 계속 실행될 수 있다.<br>
스레드가 특정 작업을 기다리지 않고 진행하는 것이 목적이라면, 필요에 따라 스레드 여러 개를 생성하고 작업을 분할하여 스레드에서 실행해도 된다.<br>

## 4.5.3 다중 코어와 다중 스레드

다중 코어 리소스를 최대한 활용해야 할 때 프로그래머가 가장 선호하는 도구는 스레드이다.<br>
일반적으로 생성되는 스레드 수는 코어 수와 일정한 선형 관계를 유지해야 한다.<br>
스레드가 순수하게 계싼을 위한 것이고 입출력이나 동기화 같은 작업이 없다면, 코어당 스레드 하나가 가장 나은 선택이다. 그러나 스레드에는 일정한 입출력과 동기화 등이 필요하므로 이때는 스레드 수를 적당히 늘려 운영 체제가 CPU에 할당할 수 있는 충분한 스레드를 확보하면 시스템 성능을 향상시킬 수 있다.<br>
하지만 스레드 수가 한계에 달하면 운영 체제 성능이 떨어지기 시작하는데, 이는 한 스레드에서 다른 스레드로 전환할 때 부담이 증가하기 때문이다.<br>