## 2.8 높은 동시성과 고성능을 갖춘 서버 구현
### 2.8.1 다중 프로세스 
1. 부모 프로세스가 사용자 요청 수신
2. 자식 프로세스를 생성
3. 자식 프로세스가 사용자 요청을 처리 

**장점** 
- 프로그래밍이 간단
- 각 프로세스의 주소 공간이 격리되어 있기 때문에 하나의 프로세스에 문제가 발생하더라도 다른 프로세스에는 영향을 미치지 않는다.
- 다중 코어 리소스를 최대한 활용할 수 있다. 

**단점**
- 각 프로세스의 주소 공간이 격리되어 있어, 프로세스 간 통신이 복잡하다. 
- 프로세스를 생성할 때 부담이 크다. 

### 2.8.2 다중 스레드 
각 요청에 대응하는 스레드를 생성한다.
- 스레드는 프로세스 주소 공간을 공유하므로, 다중 프로세스의 단점이 해결된다!

**단점**
- 같은 주소 공간을 공유하기 때문에, 스레드에 문제가 생겨 강제 종료하게 되면 같은 프로세스를 공유하는 모든 스레드, 프로세스가 다같이 강제 종료된다.
- 여러 스레드가 공유 리소스에 접근할 수 있어 스레드 안전 문제가 발생할 수 있다.
  - 상호 배제, 교착 상태 등의 문제 해결을 위해 프로그래머가 신경써야 한다.
- 동시 요청 수가 매우 많은 경우 성능 문제가 발생할 수 있다. (초당 수만 ~ 수십만 개)
  - 스레드를 생성할 때도 부담이 존재
  - 스레드 전환 시 성능 손실 

### 2.8.3 이벤트 순환과 이벤트 구동 
**이벤트 기반 프로그래밍** : GUI 프로그래밍, 서버 프로그래밍에서 많이 사용
- 필요한 두 가지 요소 
  1. **이벤트** : ex) 입출력 (네트워크 데이터 수신 여부, 파일의 읽기 및 쓰기 가능 여부 등)
  2. **이벤트를 처리하는 함수** : 보통 이벤트 핸들러라고 부른다. 
  
> 1. 이벤트가 도착할 때까지 기다린다. 
> 2. 이벤트가 도착하면 이벤트 유형을 확인한다. 
> 3. 해당 유형의 이벤트 핸들러를 찾는다. 
> 4. 이벤트 핸들러를 호출한다.
- while, for 반복문을 사용해 이벤트를 지속해서 수신하고 처리해야 한다. -> **이벤트 순환**

```
while(true)
{
    event = getEvent(); // 이벤트 수신 대기
    handler(event); // 이벤트 처리 
}
```
**문제점**
- 첫 번째 : getEvent 같은 함수 하나로 어떻게 여러 이벤트를 받을 수 있을까?
- 두 번째 : 이벤트를 처리하는 <code>handler</code> 함수는 이벤트 순환과 같은 스레드에서 실행되어야 할까? 

### 2.8.4 첫 번째 문제 : 이벤트 소스와 입출력 다중화
리눅스와 유닉스에서 프로그램은 '**파일 서술자**'를 사용해 입출력 작업을 실행한다. 
- 사용자 연결이 10개라면, 소켓 서술자 10개를 감시하고 있다가 데이터가 들어오면 알려달라고 운영체제에게 전달하는 방식을 사용하자 -> **입출력 다중화**
  - 리눅스의 <code>epoll</code>
  
![image](https://blog.kakaocdn.net/dn/bMLmVe/btsI03lEMFP/PaSHlJydXO2o3FEfn15tWk/img.png)

### 2.8.5 두 번째 문제 : 이벤트 순환과 다중 스레드
만약 이벤트 핸들러가 다음과 같다면..
1. 입출력 작업이 없다.
2. 작업이 간단해 소요 시간이 매우 짧다.

-> 이런 경우에는 이벤트 순환과 이벤트 핸들러를 같은 스레드에서 실행해도 괜찮다!

---
만약 이벤트 핸들러의 소요 시간이 길어진다면.. -> **다중 스레드**를 활용하자. 
- 이벤트 순환 스레드에서 요청을 받고 각 작업자 스레드로 분배한다. -> 반응자 패턴

### 2.8.6 카페는 어떻게 운영되는가 : 반응자 패턴 
- 커피나 우유처럼 간단한 메뉴는 카운터에서 주문을 받고 바로 만들어도 무리 X
- 만약 복잡한 메뉴가 들어왔다면, 내가 음식을 만드는 동안 카운터에서 주문을 받을 사람이 없기 때문에 대기가 엄청나게 늘어난다. 
  - 주방에 여러 요리사를 두고 나는 카운터에서 주문만 받는다. 
  - 요리가 완료되면 나에게 알려준다.
> - 고객 -> 이벤트 순환
> - 주방 요리사 -> 작업자 스레드
> - 카페 운영 방식 -> 반응자 패턴 

### 2.8.7 이벤트 순환과 입출력 
- 이해가 안된다...


### 2.8.8 비동기와 콜백 함수 
