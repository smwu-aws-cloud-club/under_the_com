## 2.2 스레드 간 공유되는 프로세스 리소스
### 2.2.1 스레드 전용 리소스
- 상태 변화 관점에서 봤을 때, 스레드 = 함수 실행 (진입함수)
> 함수 실행에는 어떤 정보가 존재할까? 즉, 각 스레드마다 필요한 정보는 무엇일까?
  - 함수 반환값, 매개변수, 지역 변수 : 스택 프레임에 저장
  - PC 레지스터
  - 스택 포인터 (스택 상단 위치를 저장)
  - 함수 실행 시 사용되는 레지스터 정보

=> 위 정보들을 '**스레드 상황 정보**'라고 한다.
스택 영역를 제외한 프로세스 주소 공간의 나머지는 모든 스레드가 함께 공유한다.

Q. 스택 포인터 등의 정보는 어디에 저장되는가?

### 2.2.2 코드 영역 : 모든 함수를 스레드에 배치하여 실행할 수 있다
- 코드 영역 : 변환된 기계 명령어가 저장되는 영역
- 코드 영역은 스레드 간 공유 -> 특정 함수를 특정 스레드에서만 실행되도록 할 수 없다.
- 코드 영역은 읽기 전용으로, 실행 시간 동안 스레드가 코드 영역 내용을 변경할 수 없다. -> **스레드 안전 문제 발생 x**

### 2.2.3 데이터 영역 : 모든 스레드가 데이터 영역의 변수에 접근할 수 있다
- 데이터 영역 : 전역 변수가 저장되는 영역
- 전역 변수 인스턴스 하나를 공유하는 형태
- 특정 스레드가 전역 변수값을 변경하면 다른 스레드에서 참조할 때 변경된 값이 잘 반영되어 있다.

### 2.2.4 힙 영역 : 포인터가 핵심이다
- 힙 영역 : malloc 함수, new 예약어로 요청하는 메모리가 할당
- 모든 스레드는 포인터만 얻을 수 있다면 원하는 데이터에 접근 가능 

### 2.2.5 스택 영역 : 공유 공간 내 전용 데이터 
- 실제 스레드 스택 영역 구현에서, 각 스택 영역은 격리되어 있지 않고, 보호되어 있지 않다.
- 즉, 다른 스레드의 스택 영역에 있는 변수를 변경할 수 있고 이는 **버그**로 이어질 수 있다!
  - 오류 원인을 찾기도 쉽지 않음
  
### 2.2.6 동적 링크 라이브러리와 파일 
> 🔥 **링크 리마인드**
>> - **정적 링크** : 종속된 모든 라이브러리가 실행 파일에 포함
>> - **동적 링크** : 프로그램 시작/실행 시점에 종속된 라이브러리 코드와 데이터를 프로세스 주소 공간에 넣어줘야 함 

- 동적 링크에서 추가되는 라이브러리 코드와 데이터는 스택-힙 사이의 여유 공간에 배치 -> 이 또한 스레드 간 공유 

### 2.2.7 스레드 전용 저장소 
- 스레드 전용 저장소에 저장되는 변수 
  - 모든 스레드에서 접근할 수 있다.
  - 스레드마다 다른 인스턴스가 생성되므로, 변경 사항은 해당 스레드 내에서만 적용 
<pre><code>
// 전역 변수
int a = 1;

// 스레드 전용 저장소 변수
__thread int a = 1;
</code></pre>