## 2.6 동기와 비동기를 철저하게 이해한다
### 2.6.1 - 2.6.2 실생활 예시 
상황 1
- 상사가 하던 일을 멈추고 내가 하는 일이 끝나기를 기다리고 있다. -> 동기
- 상사가 나에게 일을 맡긴 후 자신이 할 일을 하고 있다. -> 비동기

상황 2
- 전화 통화 : 상대가 말하면, 나는 기다려야 한다.
- 이메일 : 상대가 이메일을 보내면, 내가 회신하는 동안 상대는 다른 일을 할 수 있다.

> **동기는 기다려야 하고, 비동기는 기다릴 필요가 없다!**

### 2.6.3 동기 호출
```
funcA() 
{
    funcB();
}
```
- funcA에서 funcB를 호출하고, 실행이 완료될 때까지 기다린다.
- funcA와 funcB는 **같은 스레드에서 실행**된다.
<br>


**입출력 작업** 

```
...

read(file, buf); // 실행이 중지되고 파일을 읽기 시작 

... // 파일 읽기가 완료되면 실행 
```
- 파일 읽기 작업을 위해 read를 호출한 스레드가 일시 중지되고, 커널이 디스크의 내용을 읽어오면 스레드가 다시 깨어난다. (블로킹 입출력)
- 이 경우 호출 부분과 파일을 읽는 부분이 **다른 스레드에서 실행**된다. 
  - 같은 스레드에서 실행되는지 여부는 동기 작업과 관련 X

**정리** 
- 동기 호출은 호출자가 요청한 작업이 끝날 때까지 기다려야 한다. -> 효율이 떨어짐

### 2.6.4 비동기 호출
- 일반적으로 시간이 많이 걸리는 입출력 작업을 백그라운드 형태로 실행한다. 
  - 작업 예시 : 디스크 파일 읽고 쓰기, 네트워크 데이터 송수신, 데이터베이스 작업
  
> 비동기 호출 후 작업의 실제 완료 시점을 알 수 있을까? 
> 작업에 대한 결과는 어떻게 처리해야 할까?

**1. 호출자가 실행 결과를 신경 쓰지 않을 때**
- 콜백 함수를 사용하자. 
  - 작업 결과를 처리하는 함수를 매개변수로 함께 넘겨준다. 

**2. 호출자가 실행 결과를 알아야 할 때**
- 알림 작동 방식을 사용하자.
  - 작업 실행이 완료되면 호출자에게 알려주고, 결과 처리는 호출 스레드에서 진행한다.

### 2.6.5 웹 서버에서 동기와 비동기 작업 
사용자가 데이터베이스 접근이 필요한 요청을 보냈다고 가정해보자. 
- 사용자가 보낸 요청은 다음과 같은 과정으로 처리된다.
```
A;
B;
C;
데이터베이스 요청;
D;
E;
F;
```
- 위 과정 중 데이터베이스 요청에서만 입출력 작업이 필요하다.

일반적인 웹 서버에는 **1) 주 스레드**, **2) 데이터베이스 처리 스레드** 가 존재한다.
<br>
---

**동기 처리 방식**
1. **주 스레드**에서 A, B, C 수행 후 데이터베이스 요청을 보낸다.
2. **데이터베이스 처리 스레드**에서 처리를 완료한 후 결과를 반환한다.
3. **주 스레드**에서 다시 D, E, F를 수행한다. 

- 비동기 처리로 효율성을 높이자 

---

**비동기 처리 - 1) 주 스레드가 데이터베이스 처리 결과를 신경쓰지 않을 때** (2.6.4 참고)
<br>처리 결과를 신경쓰지 않는다는 것의 의미..? 
1. 데이터베이스 처리 후 실행되는 D, E, F 작업을 묶어 함수를 만들고, 데이터베이스 요청 시 매개변수로 넘겨준다. (콜백함수)
2. 데이터베이스 스레드에서 D, E, F 작업이 진행된다.

    > **데이터베이스 스레드에서 함수를 만들지 않고, 콜백 함수를 통해 전달받는 이유는?**
      > -  **관심사 분리!**
      >   - 데이터베이스 스레드의 관심사는 오직 데이터베이스 처리
      >   - 데이터베이스의 결과를 처리하는 것은 호출자가 알고 있어야 할 부분이므로, 호출자가 전달해준 함수를 데이터베이스에서는 그저 수행하기만 한다.
- 스레드의 유휴시간이 없어지면서 효율성이 극대화된다!
  - 시스템 리소스를 최대한 활용 가능
  - 시스템 응답 속도 향상 

**단점**
- 동기 프로그래밍보다 이해하기 어렵다. 
- 유지 보수가 어렵다.

---

**비동기 처리 - 2) 주 스레드가 데이터베이스 작업 결과를 알아야 할 때** (2.6.4 참고)
1. 주 스레드에서 데이터베이스 요청을 보내고, 다른 할 일을 한다.
2. 데이터베이스 스레드에서는 작업을 마친 후 결과를 주 스레드에게 알려준다.
3. 알림을 받은 주 스레드는 D, E, F를 수행한다.

<br>

> **주의!**
> - 항상 비동기 호출이 더 효율적인 것은 아니므로, 구체적인 상황을 분석하고 선택해야 한다!