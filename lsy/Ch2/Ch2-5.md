## 2.5 콜백 함수를 철저하게 이해한다
### 2.5.1 모든 것은 다음 요구에서 시작된다
만약, 여러 곳에서 호출하는 함수가 존재하고, 어떤 곳에서 호출되느냐에 따라 조금씩 다르게 동작해야 하는 함수라면? 
```c
void make_donut() // 도넛을 생성하는 함수
{
    ...
    if(TeamA) 
    {
        formed_A();
    } 
    else if(TeamC)
    {
        formed_C();
    }
    ...
}
```
위 예시처럼 두 경우만 있는 것이 아니라 Team이 계속 늘어난다면? 분기처리로 이 모든 경우를 커버해줄 수 있을까? 
-> 변경되어야 하는 코드를 내부에서 구현하지 말고, 매개변수로 받아버리자!

### 2.5.2 콜백이 필요한 이유
변수처럼 넘겨주는 함수 -> **콜백 함수**
<br>
콜백 함수를 사용하면 위의 예시가 아래처럼 바뀐다!
```
void formed_C()
{
...
}

make_donut(formed_C); 

```
- make_donut() 내부에서 여러 함수들을 정의할 필요 없이 호출부에서 필요한 함수를 만들어 전달한다.

### 2.5.3 비동기 콜백
만약 make_donut 함수의 실행 시간이 길어지면 어떻게 될까?
```
make_donut(formed_C); 
something_important(); // 중요 코드
```
- make_donut 함수가 실행되는데 30분이 소요된다면, 중요 코드는 30분이나 실행되지 못한 채로 기다려야 한다.
```
void real_make_donut(func f) 
{
    ...
    f();
    ...
}

void make_donut(func f) {
    thread t(real_make_donut, f);
}
```
```
make_donut(formed_C); 
something_important(); // 중요 코드
```

- 위처럼 수정 후 다시 호출부를 확인해보자. 
- make_donut 함수는 스레드 t를 만들고 바로 반환되고, something_important 함수가 호출된다.
- 이때 something_important가 실행될 때 실제로 도넛이 생성되어 있지 않은 상태일 수 있다. 
- 호출 스레드가 콜백 함수 실행에 의존하지 않는 것을 **비동기 콜백**이라고 한다.

### 2.5.4 비동기 콜백은 새로운 프로그래밍 사고방식으로 이어진다
> **기존 동기 호출**
> 1. 함수를 호출하고 실행 결과를 리턴받는다.
> 2. 리턴받은 결과를 처리한다.

> **비동기 호출**
> 1. 함수를 호출한 후, 바로 반환된다.
> 2. 함수 실행 작업은 함수를 호출하는 스레드가 아닌 다른 곳에서 처리되고, 우리가 제어할 수 없다. 

### 2.5.5 콜백 함수의 정의 
**콜백함수** : 다른 코드에 매개변수로 전달되는 실행 가능한 코드 
- 함수는 내가 작성했는데, 그 함수가 실행되는 것은 내가 참조하는 외부 모듈이다.
- 우리는 콜백 함수를 작성할 책임만 있고, 호출하지는 않는다.
> **사용 예시**
> - 파일 전송 완료, 데이터 수신 등의 이벤트
> - 각 이벤트에 대응하는 콜백함수를 등록
> - 이벤트 발생 시 콜백함수가 자동으로 호출 ->이벤트 중심 프로그래밍에 적합

### 2.5.6 두 가지 콜백 유형 
**1. 동기 콜백** 
- 블로킹 콜백이라고도 한다.
- 예시
  - 함수 A를 호출할 때 매개변수로 콜백함수를 전달
  - A가 반환되기 전에 콜백함수가 실행됨
  
**2. 비동기 콜백**
- 예시
  - 함수 A를 호출할 때 매개변수로 콜백함수를 전달 
  - 함수 A의 호출은 즉시 완료된다.
  - 주 프로그램(함수 A를 호출한 곳)과 콜백함수의 실행이 동시에 진행될 수 있다.
    - 주 프로그램과 콜백함수는 서로 다른 스레드 혹은 프로세스에서 실행된다.

<br>

> - **동기 콜백**이 진행되는 동안에 주 프로그램은 아무 일도 할 수 없다. 
> - **비동기 콜백**은 주 프로그램이 계속 실행되기 때문에, 다중 코어 리소스를 더 잘 활용!
>   - 입출력 작업, 웹 서비스(동시성 높음)

### 2.5.7 비동기 콜백의 문제 : 콜백 지옥 
비즈니스 구성이 복잡할 경우, 서비스 호출이 비동기 콜백으로 이루어진다면 콜백 지옥에 빠질 수 있다.
- **콜백 지옥** : 여러 개의 비동기 작업이 순차적으로 처리되어야 한다면 함수가 엄청나게 중첩되어, 가독성이 떨어지고 유지보수가 어려워진다.

![image](https://blog.vietnamlife.info/wp-content/uploads/2023/04/callback-hell.jpg)
