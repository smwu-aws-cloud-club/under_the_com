# Additional Research

## 스레드는 프로세스 주소 공간을 공유한다

> 원래 스레드 하나가 존재하는데 새롭게 스레드 a, b를 만들고 끝날 때 주 스레드로 합쳐지는 건지? <br>
> 스레드는 그냥 없어지는 건지? 만약 그렇다면 없어지는 시점은 어떻게 정의할 수 있는지? <br>

- 합쳐진다는 개념은 존재하지 않음. 각각 독립적
- 스레드는 종료되면 자동으로 없어짐 (스레드 풀과는 다른 경우임)
- 스레드 종료 시점
  - 스레드 내에서 실행 중인 함수나 코드 블록이 모두 끝났을 때
  - 메인 함수가 끝날 때
  - pthread_exit() 같은 함수를 사용했을 때

<br>

## 스레드 풀

> 스레드와 스레드 풀의 종료 시 차이점이 뭔지?

- 미리 여러 개의 스레드를 생성해 두고, 요청이 들어오면 할당
- 작업이 끝나면 완전히 소멸되지 않고, 대기 상태(idle)
- 최소/최대 스레드 개수를 지정할 수 있음
- 일정 시간 동안 아무 일도 하지 않으면, 풀의 설정에 따라 종료될 수도 있음
  - 단, 이 경우 최소 개수는 유지되며, 최소 개수를 초과한 스레드만 종료됨

## 단일 코어인 상황에서도 스레드 여러 개를 생성할 수 있음

> 다중 코어일 때와 스레드 실행 소요 시간이 얼마나 차이날까?

- 단일 코어는 문맥 교환 비용 때문에 각각 일을 처리하는 시간 +a가 걸릴 수 있음
  - 문맥 교환 비용: 스레드 간에 실행을 전환하는 데 드는 오버헤드
  - A가 4분, B가 3분 소요된다면 → 7분 +a
- I/O 대기 시간 활용, 비동기 작업 처리 등을 할 때 사용할 수 있음

## 스택 영역이 여러 개 필요하다. 프로세스의 주소 공간에 각 스레드를 위한 스택 영역이 별도로 있어야 합니다.

> 그럼 스택 용량은 어떻게 나눠지는 것인지? <br>
> 필요한 용량은 어떻게 아는지?

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FekjOJn%2FbtqCd1BgeYx%2FeCoQudE99vW6bN29w6kWnk%2Fimg.png" width="300"> <br>

- 스택 크기를 미리 계산해서 할당하는 것은 아님
- OS는 기본적으로 정해진 크기를 할당하고, 스레드가 깊은 함수 호출이나 많은 지역 변수를 사용하는 경우 스택 오버플로우를 방지하기 위해 추가적인 처리

## 상호 배제

> 상호 배제를 어떻게 해야 하는지?

- 임계 영역을 한 스레드만 배타적, 독점적으로 사용
- 먼저 진입한 스레드가 임계 영역의 실행을 끝마칠 떄까지 다른 스레드가 진입하지 못하도록 보장
- 하나의 개념! 구현 하는 데에는 여러 방법이 있음
  - 구현을 위해 lock, Semaphore 등을 사용

## 세마포어

> 세마포어가 무엇인지?

<img src="https://velog.velcdn.com/images/octo__/post/ec806c01-05bc-4260-a198-466e775e3835/image.png" width="300"> <br>

- 멀티프로그래밍 환경에서 공유 자원에 대한 접근을 제어하는 동기화 도구
  - 1개의 공유되는 자원에 제한된 개수의 프로세스(Process), 또는 스레드(Thread)만 접근할 수 있도록
- 교착 상태(DeadLock)에 대한 해법
- 상호 배제 알고리즘(Mutual Exclusion Algorithm)에 기반
  - 동시 프로그래밍에서 공유 불가능한 자원의 동시 사용을 피하기 위해 사용되는 알고리즘
- 변수 S와 P 연산, V 연산으로 구성
  - S: 일반적으로 정수형 변수 (이진형/계수형)
  - P: 임계 영역을 사용하려는 프로세스들의 진입 여부를 결정하는 조작(= Wait 동작)
  - V: 대기 중인 프로세스를 깨우는 신호(Wake-up) (= Signal 동작)

## 스레드가 func 함수를 호출할 때 해당 스레드에 속하는 리소스 주소를 전달

> 이해가 가지 않음

= 각 스레드가 자신만 사용하는 변수(리소스)를 함수에 전달하라는 의미

- 스레드 간의 공유 리소스를 피하자
- 각각의 스레드가 자신만의 리소스를 사용하도록 하자

## 잠금 또는 원자성 작업

> 이게 무엇인지?

- 잠금
  - 한 번에 하나의 스레드만 특정 자원에 접근하도록 제한하는 도구
- 원자성
  - 여러 개의 쓰레드(Thread)가 존재할 때, 특정 시점에서 어떤 메소드(Method)를 2개 이상의 쓰레드가 동시에 호출하지 못하는 것
